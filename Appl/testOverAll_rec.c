
#include "tests.h"


void testall_rec(){
  Crypto_OperationModeType mode = CRYPTO_OPERATIONMODE_SINGLECALL;
  uint32 AESKeyMatrialLength=32;
  uint32 AES192KeyMatrialLength=24;
  uint32 AESKeyIVLength=16;
  uint32 HmacKeyLength=64;
  uint32 HmacResLength=20;
  uint32 Sha1ResLength=20;
  uint32 msgLength=624;
  uint32 AES_DEC_jobId =11; //256
  uint32 Hmac_jobId =13;
  uint32 Sha1_jobId =0;
  uint32 SeedLength=16;
  uint32 AES192_DEC_jobId =20;
  uint16 i,j=0;
  bool hash_ver=TRUE;
  bool mac_ver=TRUE;
  uint8 verHash[]="HASH VERIFIED";
  uint8 WrongHash[]="HASH Isn't VERIFIED";
  uint8 verMac[]="MAC VERIFIED";
  uint8 WrongMac[]="MAC Isn't VERIFIED";
  /*
   static uint8 ip [644]={0xe9,0x2a,0x4c,0x26,0x7e,0x66,0xbb,0x34,0xe8,0x40,0xfa,0xfb,0x6c,0xd8,0x42,0x91,0x5f,0x88,0xc6,0xee,0xe4,0xa9,0x67,0x4c,0x62,0x1d,0x52,0xde,0xae,0xd0,0x86,0xea,0x6f,0xfa,0x86,0x68,0x0d,0x73,0xed,0x11,0xae,0x0c,0xdd,0x43,0xb7,0x58,0x9a,0x43,0x4a,0xa4,0x02,0x08,0xa2,0x0f,0xc4,0xc5,0x37,0x10,0x62,0xa4,0xfe,0x85,0x2e,0x10,0xd1,0xe4,0x99,0xd4,0x94,0xdf,0xd2,0xf5,0x9d,0xc7,0xdc,0x7a,0xd7,0x42,0x69,0xbc,0xd6,0xe3,0x87,0x4a,0x1f,0xa5,0xaa,0x09,0xc3,0x64,0x3a,0x4c,0x0f,0xa7,0x90,0x32,0x31,0x0d,0x14,0xd9,0x12,0x37,0xfe,0x99,0x29,0x22,0x47,0xe0,0x91,0x6f,0x8f,0x6d,0x9f,0xd1,0xf3,0xf6,0x74,0xb7,0x80,0x53,0xae,0x99,0xd2,0xd8,0x5a,0xa6,0xd3,0x97,0xb2,0x1d,0x58,0xb6,0x3e,0x4b,0x52,0x02,0x9d,0x69,0x61,0xaf,0x60,0xa2,0x88,0xc3,0xf9,0x5e,0x96,0xd2,0x3e,0x9b,0x79,0x0b,0x30,0x38,0x8f,0x16,0x70,0x48,0x35,0x19,0x22,0x4e,0xb0,0xe0,0x9c,0x18,0xf2,0x94,0xfe,0x69,0xf9,0x3d,0xfc,0x45,0x94,0x61,0xe8,0x48,0xa3,0x1e,0x8e,0x02,0xdb,0x18,0xbb,0x8d,0x0a,0x56,0xa7,0xd6,0x95,0xb4,0x81,0x41,0xc1,0x17,0x2b,0xb3,0x23,0xcc,0xa3,0x08,0x31,0x69,0x78,0xe3,0xe2,0x61,0x56,0x31,0x6e,0x86,0x2c,0xe9,0xd3,0x2a,0xcb,0xdc,0x30,0x91,0x28,0x24,0x59,0x75,0xa1,0xd8,0xa2,0xe8,0xcc,0x99,0x80,0x90,0x21,0x53,0x2e,0x43,0xc6,0x51,0x77,0xce,0xea,0x16,0x51,0xff,0x5a,0x4a,0xec,0x66,0x7e,0x03,0xa6,0xb8,0x44,0x0f,0x14,0x73,0x5d,0x85,0x53,0x61,0xd0,0x67,0xf4,0xb9,0x7e,0x67,0x74,0x64,0xef,0x50,0x76,0x27,0x7d,0x8c,0x32,0x1b,0x18,0xd2,0xe1,0xd5,0x16,0x72,0x9e,0x68,0x76,0x4d,0x9f,0x03,0x4d,0x0d,0x67,0x68,0x2b,0xd0,0x8b,0xf2,0x11,0xc9,0x23,0x37,0x7a,0x7a,0x74,0x71,0x8a,0xfc,0xc4,0xa4,0x94,0x15,0xc6,0x8d,0xfe,0x46,0x1f,0xd5,0xef,0x78,0x0a,0x38,0xd3,0xfc,0x56,0xb2,0x4c,0xa5,0xa9,0x83,0x34,0xd6,0xca,0xf2,0x81,0x33,0xa1,0x25,0x02,0x22,0x92,0x1c,0xb2,
   0x9a,0x75,0xe8,0xd9,0x76,0x91,0xe0,0xbb,0x42,0x91,0x29,0xb5,0x37,0x5d,0xfe,0x0d,0x2d,0x54,0xa4,0x68,0x8d,0xae,0xe2,0x83,0x0d,0x4d,0xa0,0xeb,0x67,0xfb,0xfa,0xe6,0x3d,0x9b,0x4f,0xce,0xa7,0xd0,0xb8,0x5a,0x51,0x3c,0xc5,0x80,0xa6,0x71,0x67,0x84,0x79,0xce,0xab,0x24,0xb8,0xa1,0x14,0xb1,0x94,0x94,0x1f,0x87,0x02,0xff,0xc0,0x8b,0x1b,0x7f,0xd6,0xf0,0x18,0x6e,0xa0,0x09,0x54,0x1d,0x00,0x54,0x07,0xb7,0xc9,0xbc,0xd5,0x28,0x2d,0xd3,0x41,0xa8,0xee,0x75,0x78,0xdd,0x42,0x3b,0x98,0xc0,0xc4,0x02,0x18,0xaf,0x59,0xd3,0x2d,0xba,0xc0,0xc6,0xec,0x51,0xb2,0x8c,0xc8,0x8d,0x2a,0x7a,0xc0,0x89,0x0e,0x5e,0xf8,0xf8,0xcc,0x4f,0xf8,0x2c,0x34,0xd7,0x17,0x3f,0x23,0xd8,0xdf,0xc4,0x49,0x5c,0xa5,0xdf,0x9f,0x40,0x84,0x38,0x1c,0xc1,0x16,0x75,0x5d,0x5c,0x54,0xfa,0xc6,0x9f,0x66,0x4d,0x84,0xfa,0x3f,0xdc,0x71,0xf3,0xa3,0x51,0x0b,0x5c,0x86,0x53,0xb7,0xfe,0x95,0x49,0x2f,0xde,0x52,0x37,0x21,0x25,0x0b,0xda,0x6c,0x25,0xd2,0x0b,0xbe,0x3c,0x38,0xb0,0xfd,0xf6,0x2c,0xd8,0xaa,0xaf,0x2b,0xac,0x62,0x2f,0xd3,0xd7,0xda,0x7e,0x1c,0x7e,0x09,0xa4,0x29,0x4b,0x6a,0xe6,0xd3,0x00,0xbd,0x51,0x51,0xd1,0x93,0x9a,0xf5,0xf7,0x2e,0x40,0xe8,0x0e,0xb5,0x3c,0x0d,0x91,0x56,0xa0,0xc1,0x46,0xb3,0x50,0xce,0x49,0x6c,0xb4,0xd4,0xeb,0x60,0x99,0xf6,0x7a,0x08,0x0f,0x23,0x8b,0xf6,0x21,0xeb,0xcc,0xef,0x02,0x99,0x88,0xcc,0x30,0xa7,0x5e,0x16,0xc6,0x33,0x41,0xc0,0x45,0x69,0xa2,0xb0,0xc4,0x1c,0x75,0x4a,0x88,0x6d,0x2c,0x72,0xbf,0xb8,0x3d,0x32,0x71,0xae,0x32,0x5a,0x4c,0x92,0xea,0x30,0x94,0xa7,0xd7,0x6c,0x15,0xf2,0xb0,0x80,0xaa,0xb9,0x71,0x46,0x88,0xb4,0x27,0x90,0x54,0xab,0x24,0x53};
   */
  static uint8 ip [692];


  uint8 AES_res_DEC[624] ={0} ; //for dec result
  uint8 Hmac_sha1_res[20] ={0xd0,0x9a,0x8d,0x1e,0x9b,0xf5,0x00,0x6a,0xd0,0x02,
                            0x24,0xe1,0x50,0xa1,0x4f,0xfd,0x7a,0xfa,0xa7,0x9c};

  uint8 Hash_res[20]={0x94,0xa7,0xd7,0x6c,0x15,0xf2,0xb0,0x80,0xaa,0xb9,0x71,0x46,0x88,0xb4,0x27,0x90,0x54,0xab,0x24,0x53};

   uint8 Aes_IV_Enc_SEED [16] ={};
   uint8 Aes_Key_Enc_SEED [16]={};
   uint8 Hmac_Key_Enc_SEED [16] ={};
   uint8 Aes_IV_SEED [16] ={};
   uint8 Aes_Key_SEED [16]={};
   uint8 Hmac_Key_SEED [16] ={};

   const uint8 keysSeedMat[16]={
                              0x1a,0x2b,0x35,0x55,0x99,0xba,0x60,0x4b,
                              0x05,0x1c,0x2f,0xcd,0x7e,0x63,0x62,0xec,

    }; //exits both

    const uint8 keysSeedIV[16]={
                               0x11,0x22,0x36,0x75,0x79,0xba,0x60,0x4b,
                               0x85,0x3c,0x43,0x7d,0x6e,0x60,0x82,0x1c

     }; //exits both


   uint8 AESKeyMatrial[32]={0};
   uint8 AESKeyIV[16]={0};
   uint8 AESKeyMatrial192[24]={0};
   uint8 AESKeyIV192[16]={0};


 uint8 AESKeyMatrial_Get[32]={0};
 uint8 AESKeyIV_Get[16]={0};
 uint8  HmacKey_Get[64]={0};

 uint8 HmacKey[64]={};


uart1_init();

uart1_recieve(ip,692);

uart_init();



/****************************************************************EtractSeeds*****************************************************************/
for(i=644;i<660;i++){
    Aes_IV_Enc_SEED[j]=ip[i]; //4EA37799108960903610229099403300
    j=j+1;
 }
const uint8* Aes_IV_Enc_SEED_Ptr=&Aes_IV_Enc_SEED[0];
j=0;
for(i=660;i<676;i++){
    Aes_Key_Enc_SEED[j]=ip[i]; // 7a2ea55466ba648b051b7fcd7a3362ec
    j=j+1;
 }
const uint8* Aes_Key_Enc_SEED_Ptr=&Aes_Key_Enc_SEED[0];
j=0;
 for(i=676;i<692;i++){
     Hmac_Key_Enc_SEED[j]=ip[i]; //4ABB2799108970223610229099423720
       j=j+1;
    }
 const uint8* Hmac_Key_Enc_SEED_Ptr=&Hmac_Key_Enc_SEED[0];
        j=0; i=0;
 /*****************************************setDecryptionKey*********************************************************************/
Std_ReturnType AES192_IV_SEED_func= Csm_RandomSeed(1,keysSeedIV,16); // 1 is seed key id
 Csm_KeySetValid(1);

Std_ReturnType AES192_IV_Gen= Csm_RandomGenerate(12,AESKeyIV192,&AESKeyIVLength);
const uint8*AES192KeyIV_Ptr=&AESKeyIV192[0];

Std_ReturnType AES192_KEY_SEED_func=Csm_RandomSeed(1,keysSeedMat,16);
Csm_KeySetValid(1);
 Std_ReturnType AES192_KEY_Gen= Csm_RandomGenerate(12,AESKeyMatrial192,&AES192KeyMatrialLength);
const uint8*AES192KeyMatrial_Ptr=&AESKeyMatrial192[0];

Std_ReturnType AES192_KEY_SET= Csm_KeyElementSet(4,1,AES192KeyMatrial_Ptr,AES192KeyMatrialLength);
Csm_KeySetValid(4);
 Std_ReturnType AES192_IV_SET=Csm_KeyElementSet(4,5,AES192KeyIV_Ptr,AESKeyIVLength);
 Csm_KeySetValid(4);
/****************************************************DecryptSeeds*****************************************************************/
 Std_ReturnType AES_IV_SEED_dec=Csm_Decrypt(AES192_DEC_jobId,mode,Aes_IV_Enc_SEED_Ptr,SeedLength,Aes_IV_SEED,&SeedLength);
 Std_ReturnType AES_Key_SEED_dec=Csm_Decrypt(AES192_DEC_jobId,mode,Aes_Key_Enc_SEED_Ptr,SeedLength,Aes_Key_SEED,&SeedLength);
 Std_ReturnType Hmac_Key_SEED_dec=Csm_Decrypt(AES192_DEC_jobId,mode,Hmac_Key_Enc_SEED_Ptr,SeedLength,Hmac_Key_SEED,&SeedLength);

/***********************************************get hmackey***************************************************************************************************************/
 Std_ReturnType Hmac_SEED_func= Csm_RandomSeed(1,Hmac_Key_SEED,16);
  Csm_KeySetValid(1);
  Std_ReturnType Hmac_Key_Gen= Csm_RandomGenerate(12,HmacKey,&HmacKeyLength);
  const uint8* HmacKeyPtr=&HmacKey[0];
  Std_ReturnType Hmac_Key_SET= Csm_KeyElementSet(6,1,HmacKeyPtr,HmacKeyLength);
  Std_ReturnType Hmac_Key_GET= Csm_KeyElementGet(6,1,HmacKey_Get,&HmacKeyLength);
  Csm_KeySetValid(6);
 /***********************************************get aeskey***************************************************************************************************************/
 Std_ReturnType AES_IV_SEED_func= Csm_RandomSeed(1,Aes_IV_SEED,16); // 1 is seed key id
 Csm_KeySetValid(1);
 Std_ReturnType AES_IV_Gen= Csm_RandomGenerate(12,AESKeyIV,&AESKeyIVLength);
 const uint8*AESKeyIV_Ptr=&AESKeyIV[0];
 Std_ReturnType AES_KEY_SEED_func=Csm_RandomSeed(1,Aes_Key_SEED,16);
 Csm_KeySetValid(1);
 Std_ReturnType AES_KEY_Gen= Csm_RandomGenerate(12,AESKeyMatrial,&AESKeyMatrialLength);
 const uint8*AESKeyMatrial_Ptr=&AESKeyMatrial[0];
 Std_ReturnType AES_KEY_SET= Csm_KeyElementSet(5,1,AESKeyMatrial_Ptr,AESKeyMatrialLength);
 Csm_KeySetValid(5);
 Std_ReturnType AES_KEY_GET=Csm_KeyElementGet(5,1,AESKeyMatrial_Get,&AESKeyMatrialLength);
 Std_ReturnType AES_IV_SET=Csm_KeyElementSet(5,5,AESKeyIV_Ptr,AESKeyIVLength);
 Csm_KeySetValid(5);
 Std_ReturnType AES_IV_GET=Csm_KeyElementGet(5,5,AESKeyIV_Get,&AESKeyIVLength);

/*************************************************testHash*****************************************************************/
 Std_ReturnType sh1_res =Csm_Hash(Sha1_jobId,mode,ip,sizeof(ip)-68,Hash_res,&Sha1ResLength);
// hash result 94a7d76c15f2b080aab9714688b4279054ab2453

for(i=0;i<20;i++){
    if(Hash_res[i]==ip[624+i]){
        //continue
    }
    else{
        hash_ver=FALSE;
        break;
    }

}


if(hash_ver==TRUE){
for(i=0;i<13;i++){
    UARTCharPut(UART0_BASE, verHash[i]);
}


 Std_ReturnType AES_DEC_RESULT=Csm_Decrypt(AES_DEC_jobId,mode,ip,msgLength,AES_res_DEC,&msgLength);
 Std_ReturnType Hmac_Sha1_RESULT=Csm_MacGenerate(Hmac_jobId,mode,AES_res_DEC,sizeof(AES_res_DEC)-20,Hmac_sha1_res,&HmacResLength);
//res d502cb687603446fd51b3f374eb1e8094f98b9bb

for(i=0;i<20;i++){
    if(Hmac_sha1_res[i]==AES_res_DEC[604+i]){
        //continue
    }
    else{
        mac_ver=FALSE;
        break;
    }

}

if(mac_ver==TRUE){
for(i=0;i<20;i++){
    UARTCharPut(UART0_BASE, verMac[i]);
    for(i=0;i<604;i++){
        UARTCharPut(UART0_BASE, AES_res_DEC[i]);
    }
}
}

else {
    for(i=0;i<20;i++){
        UARTCharPut(UART0_BASE, WrongMac[i]);
    }

}






}
else{

    for(i=0;i<19;i++){
        UARTCharPut(UART0_BASE, WrongHash[i]);
    }

}
}
